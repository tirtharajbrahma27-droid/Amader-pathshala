<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Amader Pathshala</title>

  <!-- Fonts and Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

  <style>
    :root{
      --bg:#0b1220;
      --content:#ffffff;
      --soft:#0f172a;
      --panel:#0b1220;
      --card:#0c1730;
      --muted:#93a4c0;
      --border:rgba(255,255,255,.10);
      --ring:rgba(103,232,249,.3);
      --primary:#00c853;
      --primary-600:#00b34a;
      --accent:#67e8f9;
      --danger:#ef4444;
      --danger-600:#dc2626;
      --warning:#f59e0b;
      --shadow:0 10px 40px rgba(0,0,0,.35);
      --radius:16px;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;color:var(--content);background:linear-gradient(180deg,#071022 0%, #0a1634 100%);
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      line-height:1.6;
    }
    img{max-width:100%;display:block}
    a{text-decoration:none;color:inherit}
    .container{width:min(1200px,92%);margin-inline:auto}

    /* Nav */
    .main-nav{
      position:sticky;top:0;z-index:1000;border-bottom:1px solid var(--border);
      background:rgba(8,13,26,.7);backdrop-filter:saturate(140%) blur(10px);
    }
    .nav-container{display:flex;align-items:center;justify-content:space-between;padding:.8rem 0}
    .brand{display:flex;align-items:center;gap:.9rem;color:#fff;font-weight:800;letter-spacing:.2px}
    .brand img{
      width:64px;height:64px;border-radius:50%;
      box-shadow:0 10px 20px rgba(0,0,0,.35);object-fit:cover;border:1px solid var(--border)
    }
    .brand-name{font-size:1.55rem}
    .nav-menu{list-style:none;display:flex;align-items:center;gap:1.1rem;margin:0;padding:0}
    .nav-menu a{color:#dbe7ff;opacity:.9;font-weight:600}
    .nav-menu a:hover{color:#fff;opacity:1}
    .btn-icon{
      display:inline-grid;place-items:center;gap:.4rem;background:transparent;color:#cfe3ff;
      border:1px solid var(--border);border-radius:12px;padding:.55rem .65rem;cursor:pointer
    }
    .btn-icon:hover{color:#fff;border-color:var(--accent);box-shadow:0 0 0 4px var(--ring)}
    .menu-wrapper{position:relative}
    .menu-dropdown{
      position:absolute;right:0;top:120%;min-width:230px;background:#0c1730;
      border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);padding:.45rem;display:none
    }
    .menu-dropdown.show{display:block}
    .menu-item{
      width:100%;display:block;text-align:left;padding:.7rem .8rem;border-radius:10px;
      font-weight:700;color:#dbe7ff;cursor:pointer;background:transparent;border:none
    }
    .menu-item:hover{background:rgba(255,255,255,.06);color:#fff}

    /* Hero */
    .hero-section{
      position:relative;min-height:64vh;display:flex;align-items:center;overflow:hidden;
      border-bottom:1px solid var(--border)
    }
    .hero-bg{
      position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.55) saturate(1.1);
      transform:scale(1.03)
    }
    .hero-overlay{
      position:absolute;inset:0;background:
        radial-gradient(1200px 500px at -10% 120%, rgba(0,200,83,.14), transparent 60%),
        radial-gradient(1000px 600px at 110% -10%, rgba(103,232,249,.16), transparent 60%),
        linear-gradient(180deg, rgba(7,16,34,.0) 0%, rgba(7,16,34,.35) 100%);
      pointer-events:none
    }
    .hero-content{position:relative;z-index:1;padding:5.2rem 0 4rem}
    .kicker{
      display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .6rem;border-radius:999px;
      background:rgba(103,232,249,.1);color:#b9effa;border:1px solid rgba(103,232,249,.25);font-weight:700;
      text-transform:uppercase;letter-spacing:.8px;font-size:.75rem
    }
    .hero-content h1{
      font-size:clamp(2.1rem,3.8vw,3.4rem);margin:.75rem 0 .6rem;line-height:1.15;
      text-shadow:0 6px 40px rgba(0,0,0,.35)
    }
    .hero-content p{
      font-size:clamp(1rem,1.3vw,1.15rem);max-width:720px;color:#cfe3ff;opacity:.95;margin-bottom:1.1rem
    }

    /* Sections */
    .content-section{padding:4rem 0;border-bottom:1px solid var(--border)}
    .bg-light{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02))}
    .section-title{font-size:clamp(1.4rem,2.2vw,2rem);margin:0 0 .8rem}
    .two-column-layout{display:grid;grid-template-columns:1.15fr .85fr;gap:2rem;align-items:center}
    .two-column-layout .column-image img{
      border-radius:16px;box-shadow:var(--shadow);border:1px solid var(--border)
    }

    /* Work grid */
    .impact-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1.1rem;margin-top:1.25rem}
    .impact-card{
      background:linear-gradient(180deg,#0b162f,#0a1a3d);padding:1.2rem;border:1px solid var(--border);
      border-radius:16px;box-shadow:var(--shadow);transition:transform .2s ease, border-color .2s ease;
      display:flex;flex-direction:column;gap:.5rem;position:relative
    }
    .impact-card:hover{transform:translateY(-3px);border-color:rgba(103,232,249,.25)}
    .impact-card i{
      font-size:1.5rem;color:#091829;background:linear-gradient(180deg,#67e8f9,#00c853);
      border-radius:12px;width:42px;height:42px;display:grid;place-items:center;margin-bottom:.25rem
    }
    .impact-card h3{margin:.2rem 0}
    .impact-card p{color:#a8bedf}

    /* Inline delete overlay on work cards */
    .card-edit-actions{position:absolute;top:8px;right:8px;display:none;gap:.35rem}
    body.inline-editing .impact-card .card-edit-actions{display:flex}

    /* Gallery */
    .gallery-section{margin:2rem 0 2.4rem}
    .gallery-header{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:.6rem}
    .gallery-title{
      display:inline-flex;align-items:center;gap:.6rem;background:rgba(255,255,255,.06);
      border:1px solid var(--border);border-radius:999px;padding:.35rem .8rem;font-weight:700;color:#cfe3ff
    }
    .gallery-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-top:.8rem}
    .gallery-grid img{
      aspect-ratio: 4/3;object-fit:cover;border-radius:14px;border:1px solid var(--border);
      box-shadow:var(--shadow);transition:transform .25s ease, box-shadow .25s ease
    }
    .gallery-grid img:hover{transform:translateY(-2px);box-shadow:0 16px 40px rgba(0,0,0,.45)}

    /* Footer */
    .site-footer{background:#090f1d;color:#b9c7e3;padding:1.2rem 0}
    .site-footer p{margin:0}

    /* Buttons */
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:.6rem 1rem;border-radius:12px;border:1px solid transparent;font-weight:700;cursor:pointer;transition:.15s ease}
    .btn-primary{background:var(--primary);color:#051013;border-color:var(--primary)}
    .btn-primary:hover{background:var(--primary-600)}
    .btn-secondary{background:transparent;border-color:var(--border);color:#dbe7ff}
    .btn-secondary:hover{border-color:var(--accent);color:#fff;box-shadow:0 0 0 4px var(--ring)}
    .btn-outline{background:transparent;border-color:var(--border);color:#e3eeff}
    .btn-outline:hover{border-color:var(--accent);color:#fff}
    .btn-xs{padding:.35rem .55rem;border-radius:10px;font-weight:700;font-size:.8rem}
    .btn-danger{background:var(--danger);color:#fff;border-color:var(--danger)}
    .btn-danger:hover{background:var(--danger-600)}

    /* Modal base */
    .modal{position:fixed;inset:0;background:rgba(6,10,22,.66);display:none;align-items:center;justify-content:center;z-index:1200;padding:1rem}
    .modal.show{display:flex}
    .modal-content{
      position:relative;width:min(520px,95%);background:#0c1730;border-radius:16px;border:1px solid var(--border);
      box-shadow:var(--shadow);padding:1.2rem;color:#e3eeff
    }
    .modal-close{
      position:absolute;right:10px;top:6px;border:none;background:transparent;font-size:1.6rem;cursor:pointer;color:#9bb3db
    }
    .error{color:#ff9aa2;min-height:1rem}

    /* FUTURISTIC password console */
    #password-modal .modal-content{
      width:min(560px,96%);padding:0;border:none;background:transparent;
    }
    .neo-console{
      position:relative;background:rgba(10,21,53,.68);
      border-radius:18px;padding:18px;border:1px solid rgba(255,255,255,.08);
      overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.5);
      backdrop-filter:blur(14px) saturate(130%);
    }
    .neo-console::before{
      content:"";position:absolute;inset:-2px;border-radius:20px;
      background:conic-gradient(from 180deg at 50% 50%, #67e8f9, #00c853, #67e8f9);
      filter:blur(10px);opacity:.35;z-index:0;
    }
    .neo-console::after{
      content:"";position:absolute;inset:0;border-radius:18px;
      background:
       radial-gradient(800px 400px at -10% 120%, rgba(0,200,83,.16), transparent 60%),
       radial-gradient(900px 500px at 120% -10%, rgba(103,232,249,.18), transparent 60%),
       repeating-linear-gradient(0deg, rgba(255,255,255,.04) 0, rgba(255,255,255,.04) 1px, transparent 2px, transparent 6px);
      pointer-events:none;z-index:1;
    }
    .neo-inner{position:relative;z-index:2}
    .neo-head{display:flex;align-items:center;justify-content:space-between;gap:.6rem;margin-bottom:8px}
    .neo-title{font-weight:800;letter-spacing:.4px}
    .chip{font-weight:700;font-size:.75rem;padding:.25rem .6rem;border-radius:999px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);color:#cfe3ff}
    .neo-body{padding-top:.2rem}

    .code-boxes{display:flex;gap:.6rem;justify-content:center;margin:10px 0 14px}
    .code-box{
      width:54px;height:54px;border-radius:12px;display:grid;place-items:center;font-weight:800;font-size:1.25rem;
      color:#e8fbff;background:rgba(3,9,28,.8);border:1px solid rgba(103,232,249,.25);box-shadow:inset 0 0 20px rgba(103,232,249,.08)
    }
    .code-box.filled{background:rgba(15,28,64,.9);border-color:#67e8f9}
    .code-dot{width:10px;height:10px;border-radius:50%;background:#67e8f9;box-shadow:0 0 12px #67e8f9}

    .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem;max-width:360px;margin:0 auto}
    .key{
      padding:.85rem 0;border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background:linear-gradient(180deg, rgba(6,14,36,.9), rgba(7,16,42,.9));
      color:#dff6ff;font-weight:800;cursor:pointer;box-shadow:0 10px 20px rgba(0,0,0,.3);
      transition:transform .06s ease, border-color .15s ease, box-shadow .15s ease
    }
    .key:hover{border-color:#67e8f9;box-shadow:0 0 0 4px rgba(103,232,249,.2)}
    .key:active{transform:translateY(1px)}
    .key.wide{grid-column:span 2}
    .key.confirm{background:linear-gradient(180deg, #00c853, #00b34a);color:#04160c;border-color:#00c853}
    .key.cancel{background:linear-gradient(180deg, #1b243d, #121b33)}
    .neo-foot{display:flex;justify-content:center;margin-top:10px}
    .neo-error{min-height:20px;color:#ff9aa2;text-align:center}
    .shake{animation:shake .35s ease}
    @keyframes shake{
      10%{transform:translateX(-4px)}
      20%{transform:translateX(4px)}
      30%{transform:translateX(-4px)}
      40%{transform:translateX(4px)}
      50%{transform:translateX(-3px)}
      60%{transform:translateX(3px)}
      70%{transform:translateX(-2px)}
      80%{transform:translateX(2px)}
      100%{transform:translateX(0)}
    }

    /* Editor Modal */
    .edit-modal .modal-content{
      width:min(1100px,96%);
      max-height:90vh;
      display:flex;flex-direction:column;padding:0;overflow:hidden;
      border:1px solid rgba(255,255,255,.1);background:rgba(12,23,48,.9);backdrop-filter:blur(10px);
    }
    .edit-header{
      padding:.9rem 1rem;border-bottom:1px solid var(--border);background:linear-gradient(90deg, rgba(103,232,249,.1), rgba(12,23,48,.6), rgba(0,200,83,.1));
      display:flex;align-items:center;gap:.6rem;justify-content:space-between
    }
    .edit-title{font-weight:800}
    .edit-header-right{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center}
    .edit-tabs{display:flex;gap:.4rem;flex-wrap:wrap}
    .tab-btn{padding:.45rem .75rem;border-radius:999px;border:1px solid var(--border);background:transparent;color:#cfe3ff;font-weight:700;cursor:pointer}
    .tab-btn.active{border-color:var(--accent);background:rgba(103,232,249,.12);color:#fff}
    .edit-body{flex:1 1 auto;overflow:auto;padding:1rem}
    .edit-footer{flex:0 0 auto;display:flex;justify-content:flex-end;gap:.5rem;padding:.7rem 1rem;border-top:1px solid var(--border);background:#0c1730}
    .panel{display:none}
    .panel.active{display:block}
    .panel .row{display:flex;align-items:center;justify-content:space-between;gap:.6rem;margin-bottom:.6rem}
    .panel h4{margin:.2rem 0}

    /* Images Manager */
    .image-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.7rem}
    .image-card{border:1px solid var(--border);border-radius:12px;padding:.6rem;background:#0a1531;display:grid;gap:.5rem}
    .image-card .thumb{border-radius:10px;overflow:hidden;border:1px solid var(--border);aspect-ratio:4/3;display:block;object-fit:cover}
    .image-card .row{display:flex;align-items:center;justify-content:space-between;gap:.5rem}
    .image-card small{color:#9bb3db}

    /* Gallery Manager */
    .category-list{display:grid;grid-template-columns:1fr;gap:.8rem}
    .category-card{border:1px solid var(--border);border-radius:14px;background:#0a1531;padding:.7rem;box-shadow:var(--shadow)}
    .category-card .cat-head{display:flex;align-items:center;justify-content:space-between;gap:.6rem;margin-bottom:.4rem}
    .category-card .cat-actions{display:flex;gap:.4rem;flex-wrap:wrap}
    .cat-name-input{width:min(340px,70%);padding:.5rem .6rem;border-radius:10px;border:1px solid var(--border);background:#081329;color:#e3eeff;font:inherit}
    .photo-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.6rem;margin-top:.5rem}
    .photo-card{border:1px solid var(--border);border-radius:12px;padding:.45rem;background:#081329;display:grid;gap:.45rem}
    .photo-card img{aspect-ratio:4/3;object-fit:cover;border-radius:10px;border:1px solid var(--border)}
    .photo-actions{display:flex;gap:.35rem;flex-wrap:wrap}

    /* URLs Manager */
    .urls-list{display:grid;grid-template-columns:1fr;gap:.7rem}
    .url-item{display:grid;grid-template-columns:200px 1fr auto;gap:.8rem;align-items:center;border:1px solid var(--border);background:#0a1531;padding:.6rem .8rem;border-radius:12px}
    .url-item label{color:#b9c7e3;font-weight:700}
    .url-item input{padding:.6rem .75rem;border-radius:10px;border:1px solid var(--border);background:#081329;color:#e3eeff;font:inherit}
    .url-item input:focus{border-color:var(--accent);box-shadow:0 0 0 4px var(--ring)}

    /* Inline editing */
    body.inline-editing [data-editable]{
      cursor:text;outline:2px dashed rgba(103,232,249,.35); outline-offset:2px; border-radius:6px;transition:box-shadow .15s ease, background-color .15s ease;
    }
    .inline-editor-bar{
      position:fixed;left:50%;transform:translateX(-50%);bottom:16px;z-index:1300;
      width:min(920px,94%);background:#0c1730;border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);
      padding:.6rem;display:none;align-items:center;justify-content:space-between;gap:.6rem
    }
    .inline-editor-bar.show{display:flex}
    .inline-left,.inline-right{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .inline-status{font-weight:800;color:#c2ffe0}

    /* Toasts (modern notifications) */
    .toast-container{
      position:fixed;right:16px;bottom:16px;z-index:1400;display:flex;flex-direction:column;gap:.5rem;pointer-events:none
    }
    .toast{
      pointer-events:auto;display:grid;grid-template-columns:auto 1fr auto;gap:.6rem;align-items:center;
      min-width:280px;max-width:420px;padding:.7rem .9rem;border-radius:14px;
      background:rgba(12,23,48,.95);border:1px solid rgba(255,255,255,.10);color:#e3eeff;
      box-shadow:0 12px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03);
      animation:toastIn .25s ease both;
    }
    .toast.success{border-left:4px solid var(--primary)}
    .toast.error{border-left:4px solid var(--danger)}
    .toast.info{border-left:4px solid var(--accent)}
    .toast.warning{border-left:4px solid var(--warning)}
    .toast-icon{width:28px;height:28px;border-radius:8px;display:grid;place-items:center;color:#061226;background:rgba(255,255,255,.85)}
    .toast.success .toast-icon{background:linear-gradient(180deg,#00c853,#00b34a);color:#04160c}
    .toast.error .toast-icon{background:linear-gradient(180deg,#ef4444,#dc2626);color:#300}
    .toast.info .toast-icon{background:linear-gradient(180deg,#67e8f9,#38bdf8);color:#08232a}
    .toast.warning .toast-icon{background:linear-gradient(180deg,#f59e0b,#f97316);color:#331c05}
    .toast-close{
      background:transparent;border:none;color:#9bb3db;font-size:18px;cursor:pointer;padding:.1rem .2rem
    }
    @keyframes toastIn{from{transform:translateY(8px) translateX(6px);opacity:0} to{transform:translateY(0) translateX(0);opacity:1}}
    @keyframes toastOut{to{transform:translateY(8px);opacity:0}}

    /* Responsive */
    @media (max-width: 980px){
      .two-column-layout{grid-template-columns:1fr;gap:1.2rem}
      .impact-grid{grid-template-columns:repeat(2,1fr)}
      .gallery-grid{grid-template-columns:repeat(2,1fr)}
      .brand img{width:56px;height:56px}
      .brand-name{font-size:1.35rem}
      .url-item{grid-template-columns:1fr}
    }
    @media (max-width: 560px){
      .nav-menu{gap:.7rem}
      .impact-grid{grid-template-columns:1fr}
      .gallery-grid{grid-template-columns:1fr}
      .toast-container{left:50%;right:auto;transform:translateX(-50%)} /* center toasts on small screens */
    }

    /* Smooth anchor offset */
    #about,#work,#gallery{scroll-margin-top:90px}
  </style>
</head>
<body>

  <!-- Top Navigation Bar -->
  <nav class="main-nav">
    <div class="container nav-container">
      <a href="#" class="brand">
        <img id="site-logo" data-editable-image="logo" src="https://images.unsplash.com/photo-1605721911519-3dfeb3be25e7?q=80&w=256&auto=format&fit=crop" alt="Amader Pathshala logo"/>
        <span class="brand-name" data-editable="brand-name">Amader Pathshala</span>
      </a>

      <ul class="nav-menu">
        <li><a href="#about">About Us</a></li>
        <li><a href="#work">Our Work</a></li>
        <li><a href="#gallery">Gallery</a></li>

        <!-- 3-dot Menu -->
        <li class="menu-wrapper">
          <button id="menu-button" class="btn-icon" aria-label="More options" aria-expanded="false" aria-controls="menu-dropdown">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <div id="menu-dropdown" class="menu-dropdown" role="menu" aria-hidden="true">
            <a href="next.html" class="menu-item" data-role="admin" data-requires-pass="9733">Admin</a>
            <a href="Attandance.html" class="menu-item" data-role="teacher" data-requires-pass="2015">Teacher</a>
            <button type="button" id="edit-here-btn" class="menu-item" style="display:none"><i class="fas fa-lock"></i> Edit this page</button>
          </div>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Hero Section -->
  <header class="hero-section">
    <img class="hero-bg" data-editable-image="hero-bg" src="https://images.unsplash.com/photo-1529070538774-1843cb3265df?q=80&w=1920&auto=format&fit=crop" alt="Hero background"/>
    <div class="hero-overlay"></div>
    <div class="container hero-content">
      <span class="kicker">Empower through education</span>
      <h1 data-editable="hero-title">Lighting the Path to a Brighter Future</h1>
      <p data-editable="hero-subtitle">Empowering underprivileged children through education, creativity, and community.</p>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <!-- About -->
    <section id="about" class="content-section">
      <div class="container">
        <div class="two-column-layout">
          <div class="column-text">
            <h2 class="section-title" data-editable="about-title">Our Story</h2>
            <p data-editable="about-text">
              <strong>Amader Pathshala</strong> is a non-profit organization established in 2015, dedicated to educating underprivileged tribal children. We focus on stopping child marriage and child labor, and promote creative development through music, dance, and drawing.
            </p>
          </div>
          <div class="column-image">
            <img data-editable-image="about-image" src="https://images.unsplash.com/photo-1542810634-71277d952b97?q=80&w=2070&auto=format&fit=crop" alt="Children learning happily"/>
          </div>
        </div>
      </div>
    </section>

    <!-- Our Work -->
    <section id="work" class="content-section bg-light">
      <div class="container">
        <h2 class="section-title" data-editable="work-title">Our Work</h2>
        <div id="work-grid" class="impact-grid"></div>
      </div>
    </section>

    <!-- Gallery -->
    <section id="gallery" class="content-section">
      <div class="container">
        <h2 class="section-title" data-editable="gallery-title">Gallery</h2>
        <p data-editable="gallery-desc" style="color:#a8bedf;max-width:720px">
          Moments of joy, learning, and community from our Pathshala — explore by category.
        </p>
        <div id="gallery-sections"></div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container">
      <p data-editable="footer-text">&copy; 2024 Amader Pathshala. All Rights Reserved.</p>
    </div>
  </footer>

  <!-- FUTURISTIC Password Modal -->
  <div id="password-modal" class="modal" aria-hidden="true">
    <div class="modal-content neo-console">
      <button class="modal-close" aria-label="Close">&times;</button>
      <div class="neo-inner">
        <div class="neo-head">
          <div class="neo-title">Secure Access</div>
          <span class="chip">4-digit code</span>
        </div>
        <div class="neo-body">
          <input id="password-input" type="password" inputmode="numeric" autocomplete="one-time-code" style="position:absolute;left:-9999px;opacity:0"/>
          <div class="code-boxes" id="code-boxes">
            <div class="code-box" data-i="0"></div>
            <div class="code-box" data-i="1"></div>
            <div class="code-box" data-i="2"></div>
            <div class="code-box" data-i="3"></div>
          </div>
          <div class="keypad" id="keypad">
            <button class="key" data-key="1">1</button><button class="key" data-key="2">2</button><button class="key" data-key="3">3</button>
            <button class="key" data-key="4">4</button><button class="key" data-key="5">5</button><button class="key" data-key="6">6</button>
            <button class="key" data-key="7">7</button><button class="key" data-key="8">8</button><button class="key" data-key="9">9</button>
            <button class="key cancel" data-action="cancel"><i class="fas fa-times"></i></button>
            <button class="key" data-key="0">0</button>
            <button class="key" data-action="back"><i class="fas fa-delete-left"></i></button>
            <button class="key wide" data-action="clear">Clear</button>
            <button class="key confirm wide" data-action="enter"><i class="fas fa-check"></i> Enter</button>
          </div>
          <div class="neo-foot">
            <small id="password-error" class="neo-error" aria-live="polite"></small>
          </div>
          <div class="modal-actions" style="display:none">
            <button id="password-cancel" class="btn btn-secondary">Cancel</button>
            <button id="password-confirm" class="btn btn-primary">Continue</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Editor Modal -->
  <div id="edit-modal" class="modal edit-modal" aria-hidden="true">
    <div class="modal-content">
      <div class="edit-header">
        <div class="edit-title">Page editor</div>
        <div class="edit-header-right">
          <div class="edit-tabs">
            <button class="tab-btn active" data-tab="urls-panel">Update URL</button>
            <button class="tab-btn" data-tab="images-panel">Images</button>
            <button class="tab-btn" data-tab="gallery-panel">Manage gallery</button>
          </div>
          <button id="inline-toggle-btn" class="btn btn-outline" title="Enable inline editing on the page">Enable inline editing</button>
          <button class="modal-close" aria-label="Close">&times;</button>
        </div>
      </div>

      <div class="edit-body">
        <div id="urls-panel" class="panel active">
          <div class="row">
            <h4>Menu links (Admin & Teacher)</h4>
            <small class="muted">Set the URLs that the Admin and Teacher menu items point to.</small>
          </div>
          <div class="urls-list">
            <div class="url-item">
              <label for="admin-url-input">Admin URL</label>
              <input id="admin-url-input" type="text" placeholder="admin_portal.html">
              <button id="admin-url-clear" class="btn btn-danger btn-xs" title="Clear URL">Clear</button>
            </div>
            <div class="url-item">
              <label for="teacher-url-input">Teacher URL</label>
              <input id="teacher-url-input" type="text" placeholder="teacher_portal.html">
              <button id="teacher-url-clear" class="btn btn-danger btn-xs" title="Clear URL">Clear</button>
            </div>
          </div>
        </div>

        <div id="images-panel" class="panel">
          <div class="row">
            <h4>Images on this page</h4>
            <small class="muted">Replace, hide/show any image (logo, hero background, about image, etc.).</small>
          </div>
          <div id="image-list" class="image-list"></div>
        </div>

        <div id="gallery-panel" class="panel">
          <div class="row">
            <h4>Gallery Manager</h4>
            <div>
              <button id="add-category" class="btn btn-outline btn-xs">Add category</button>
              <button id="collapse-all" class="btn btn-outline btn-xs">Collapse all</button>
              <button id="expand-all" class="btn btn-outline btn-xs">Expand all</button>
            </div>
          </div>
          <div id="category-list" class="category-list"></div>
        </div>
      </div>

      <div class="edit-footer">
        <button id="save-content" class="btn btn-primary">Save</button>
        <button id="close-editor" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Inline editor bar -->
  <div id="inline-editor-bar" class="inline-editor-bar" aria-hidden="true">
    <div class="inline-left">
      <span class="inline-status">Inline editing</span>
      <button id="add-work-card-btn" class="btn btn-outline btn-xs">+ New Work Card</button>
      <button id="open-panel-btn" class="btn btn-outline btn-xs">Open panel</button>
    </div>
    <div class="inline-right">
      <button id="inline-save-btn" class="btn btn-primary btn-xs">Save</button>
      <button id="inline-exit-btn" class="btn btn-secondary btn-xs">Exit</button>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <script>
  (() => {
    "use strict";

    // ============ State ============
    const state = {
      adminAuthedForEdit: false,
      canSeeEdit: sessionStorage.getItem("canSeeEdit") === "true",
      pending: null, // { role?, pass?, href?, action? }
      galleryData: null,
      urlsData: null,
      workData: null,
      imagesHidden: {},
      snapshot: null,
      inlineEditing: false,
      loadedPayload: null
    };

    // ============ Elements ============
    const menuBtn = document.getElementById("menu-button");
    const menuDropdown = document.getElementById("menu-dropdown");
    const editBtn = document.getElementById("edit-here-btn");
    const galleryMount = document.getElementById("gallery-sections");
    const adminLink = document.querySelector('a[data-role="admin"]');
    const teacherLink = document.querySelector('a[data-role="teacher"]');
    const workGrid = document.getElementById("work-grid");

    // Password modal elements
    const pwdModal = document.getElementById("password-modal");
    const pwdCard = pwdModal.querySelector(".neo-console");
    const pwdInput = document.getElementById("password-input");
    const codeBoxes = Array.from(document.querySelectorAll("#code-boxes .code-box"));
    const keypad = document.getElementById("keypad");
    const pwdError = document.getElementById("password-error");
    const pwdClose = pwdModal.querySelector(".modal-close");
    const pwdCancelFallback = document.getElementById("password-cancel");
    const pwdConfirmFallback = document.getElementById("password-confirm");

    // Editor modal
    const editModal = document.getElementById("edit-modal");
    const editClose = editModal.querySelector(".modal-close");
    const saveBtn = document.getElementById("save-content");
    const closeEditorBtn = document.getElementById("close-editor");

    const imagesPanel = document.getElementById("images-panel");
    const galleryPanel = document.getElementById("gallery-panel");
    const urlsPanel = document.getElementById("urls-panel");
    const imageList = document.getElementById("image-list");
    const categoryList = document.getElementById("category-list");
    const addCategoryBtn = document.getElementById("add-category");
    const collapseAllBtn = document.getElementById("collapse-all");
    const expandAllBtn = document.getElementById("expand-all");
    const tabBtns = Array.from(document.querySelectorAll(".tab-btn"));
    const inlineToggleBtn = document.getElementById("inline-toggle-btn");

    const adminUrlInput = document.getElementById("admin-url-input");
    const teacherUrlInput = document.getElementById("teacher-url-input");
    const adminUrlClear = document.getElementById("admin-url-clear");
    const teacherUrlClear = document.getElementById("teacher-url-clear");

    const inlineBar = document.getElementById("inline-editor-bar");
    const addWorkCardBtn = document.getElementById("add-work-card-btn");
    const openPanelBtn = document.getElementById("open-panel-btn");
    const inlineSaveBtn = document.getElementById("inline-save-btn");
    const inlineExitBtn = document.getElementById("inline-exit-btn");

    const toastContainer = document.getElementById("toast-container");

    // ============ Utils ============
    const $all = (sel, ctx = document) => Array.from(ctx.querySelectorAll(sel));
    const STORAGE_KEY = "ap-site-content-v16";
    const defaultLogo = "https://images.unsplash.com/photo-1605721911519-3dfeb3be25e7?q=80&w=256&auto=format&fit=crop";
    const defaultHero = "https://images.unsplash.com/photo-1529070538774-1843cb3265df?q=80&w=1920&auto=format&fit=crop";
    const defaultAbout = "https://images.unsplash.com/photo-1542810634-71277d952b97?q=80&w=2070&auto=format&fit=crop";

    function uid(prefix="id"){ return prefix+"_"+Math.random().toString(36).slice(2,9); }
    function deepClone(obj){ return JSON.parse(JSON.stringify(obj)); }
    function escapeHtml(str){
      return (str || "").replace(/[&<>'"]/g, (c) => ({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;'}[c]));
    }
    function fileToDataURL(file){
      return new Promise((resolve,reject)=>{
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Toast system
    function toast(message, type="info", duration=2500){
      const el = document.createElement("div");
      el.className = `toast ${type}`;
      const icon = type === "success" ? "fa-check"
                : type === "error"   ? "fa-xmark"
                : type === "warning" ? "fa-exclamation"
                :                      "fa-info";
      el.innerHTML = `
        <div class="toast-icon"><i class="fas ${icon}"></i></div>
        <div class="toast-msg">${escapeHtml(message)}</div>
        <button class="toast-close" aria-label="Dismiss">&times;</button>
      `;
      toastContainer.appendChild(el);
      const close = () => {
        el.style.animation = "toastOut .25s ease forwards";
        setTimeout(() => el.remove(), 260);
      };
      el.querySelector(".toast-close").addEventListener("click", close);
      setTimeout(close, duration);
      return el;
    }

    // ============ Default Data ============
    const defaultPayload = {
      text: {
        "brand-name": "Amader Pathshala",
        "hero-title": "Lighting the Path to a Brighter Future",
        "hero-subtitle": "Empowering underprivileged children through education, creativity, and community.",
        "about-title": "Our Story",
        "about-text": "<strong>Amader Pathshala</strong> is a non-profit organization established in 2015, dedicated to educating underprivileged tribal children. We focus on stopping child marriage and child labor, and promote creative development through music, dance, and drawing.",
        "work-title": "Our Work",
        "gallery-title": "Gallery",
        "gallery-desc": "Moments of joy, learning, and community from our Pathshala — explore by category.",
        "footer-text": "&copy; 2024 Amader Pathshala. All Rights Reserved.",
        "work-title-w1":"Free Education & Supplies","work-text-w1":"Providing free books, notebooks, and clothing to children.",
        "work-title-w2":"Child Protection","work-text-w2":"Running awareness campaigns on child marriage and child labor.",
        "work-title-w3":"Creative Development","work-text-w3":"Conducting regular creative classes and sports sessions.",
        "work-title-w4":"Community Empowerment","work-text-w4":"Community programs for women's empowerment and literacy."
      },
      images: {
        "logo": defaultLogo,
        "hero-bg": defaultHero,
        "about-image": defaultAbout
      },
      imagesHidden: {},
      urls: { adminHref: "admin_portal.html", teacherHref: "teacher_portal.html" },
      work: {
        cards: [
          { id:"w1", icon:"fas fa-book-open" },
          { id:"w2", icon:"fas fa-shield-alt" },
          { id:"w3", icon:"fas fa-paint-brush" },
          { id:"w4", icon:"fas fa-users" }
        ]
      },
      gallery: {
        categories: [
          { id: "annual-program", name: "Annual Program", items: [
            { id: uid("g"), src: "https://images.unsplash.com/photo-1594312646549-d73941454b54?q=80&w=1200&auto=format&fit=crop" },
            { id: uid("g"), src: "https://images.unsplash.com/photo-1619551743343-c92398459343?q=80&w=1200&auto=format&fit=crop" }
          ]},
          { id: "class", name: "Class", items: [
            { id: uid("g"), src: "https://images.unsplash.com/photo-1596499839639-38e9315572b2?q=80&w=1200&auto=format&fit=crop" },
            { id: uid("g"), src: "https://images.unsplash.com/photo-1618641793799-9039a67aa8aa?q=80&w=1200&auto=format&fit=crop" }
          ]},
          { id: "blood-camp", name: "Blood Camp", items: [
            { id: uid("g"), src: "https://images.unsplash.com/photo-1504439468489-c8920d796a29?q=80&w=1200&auto=format&fit=crop" },
            { id: uid("g"), src: "https://images.unsplash.com/photo-1526256262350-7da7584cf5eb?q=80&w=1200&auto=format&fit=crop" }
          ]}
        ]
      }
    };

    // ============ Persistence ============
    async function loadFromDatabase() {
      try {
        if (typeof window.AP_LOAD_HOOK === "function") {
          const res = window.AP_LOAD_HOOK();
          const data = (res && typeof res.then === "function") ? await res : res;
          if (data) return data;
        }
      } catch(e){ console.warn("AP_LOAD_HOOK error:", e); }
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : null;
      } catch { return null; }
    }
    async function saveToDatabase(payload) {
      try {
        if (typeof window.AP_SAVE_HOOK === "function") {
          const res = window.AP_SAVE_HOOK(payload);
          if (res && typeof res.then === "function") await res;
        } else {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
          console.info("No realtime DB hook provided (AP_SAVE_HOOK). Using localStorage fallback.");
        }
      } catch(e){
        console.error("Save error:", e);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      }
    }

    // ============ Renderers ============
    function getText(key){ return (state.loadedPayload?.text || {})[key]; }

    function renderWork(work){
      if (!work || !work.cards) return;
      state.workData = deepClone(work);
      workGrid.innerHTML = "";
      work.cards.forEach(card => {
        const el = document.createElement("div");
        el.className = "impact-card";
        el.dataset.workId = card.id;

        const icon = document.createElement("i");
        icon.className = card.icon || "fas fa-star";

        const title = document.createElement("h3");
        title.setAttribute("data-editable", `work-title-${card.id}`);
        title.innerHTML = (getText(`work-title-${card.id}`) || "New work title");

        const desc = document.createElement("p");
        desc.setAttribute("data-editable", `work-text-${card.id}`);
        desc.innerHTML = (getText(`work-text-${card.id}`) || "Work description goes here.");

        const actions = document.createElement("div");
        actions.className = "card-edit-actions";
        const del = document.createElement("button");
        del.className = "btn btn-danger btn-xs";
        del.innerHTML = '<i class="fas fa-trash"></i> Delete';
        del.setAttribute("data-delete-work", card.id);
        actions.append(del);

        el.append(icon, title, desc, actions);
        workGrid.append(el);
      });
    }

    function renderGallery(galleryData){
      if (!galleryData || !galleryData.categories) return;
      galleryMount.innerHTML = "";
      galleryData.categories.forEach(cat => {
        const section = document.createElement("div");
        section.className = "gallery-section";
        section.setAttribute("data-category", cat.id);

        const header = document.createElement("div");
        header.className = "gallery-header";
        const title = document.createElement("div");
        title.className = "gallery-title";
        title.innerHTML = `<i class="fas fa-folder-open"></i> ${escapeHtml(cat.name)}`;
        header.appendChild(title);
        section.appendChild(header);

        const grid = document.createElement("div");
        grid.className = "gallery-grid";
        (cat.items || []).forEach(item => {
          const img = document.createElement("img");
          img.src = item.src;
          img.alt = cat.name + " photo";
          grid.appendChild(img);
        });

        section.appendChild(grid);
        galleryMount.appendChild(section);
      });
    }

    // ============ Apply / Collect ============
    function applyContent(payload) {
      if (!payload) return;
      state.loadedPayload = deepClone(payload);

      renderWork(payload.work || defaultPayload.work);

      const text = payload.text || {};
      for (const [key, html] of Object.entries(text)) {
        const el = document.querySelector(`[data-editable="${CSS.escape(key)}"]`);
        if (el) el.innerHTML = html;
      }

      const images = payload.images || {};
      for (const [key, src] of Object.entries(images)) {
        const img = document.querySelector(`img[data-editable-image="${CSS.escape(key)}"]`);
        if (img && src) img.src = src;
      }
      state.imagesHidden = deepClone(payload.imagesHidden || {});
      $all("img[data-editable-image]").forEach(img => {
        const key = img.getAttribute("data-editable-image");
        img.hidden = !!state.imagesHidden[key];
      });

      state.urlsData = deepClone(payload.urls || defaultPayload.urls);
      applyUrlsToMenu();

      state.galleryData = deepClone(payload.gallery || defaultPayload.gallery);
      renderGallery(state.galleryData);
    }

    function collectContent(){
      const text = {};
      $all("[data-editable]").forEach(el => {
        const key = el.getAttribute("data-editable");
        text[key] = el.innerHTML;
      });
      const images = {};
      const imagesHidden = {};
      $all("img[data-editable-image]").forEach(img => {
        const key = img.getAttribute("data-editable-image");
        images[key] = img.src;
        if (img.hidden) imagesHidden[key] = true;
      });
      const gallery = deepClone(state.galleryData || defaultPayload.gallery);
      const urls = deepClone(state.urlsData || defaultPayload.urls);
      const work = deepClone(state.workData || defaultPayload.work);
      return { text, images, imagesHidden, gallery, urls, work, savedAt: new Date().toISOString() };
    }

    function applyUrlsToMenu(){
      if (adminLink) adminLink.setAttribute("href", (state.urlsData?.adminHref) || "admin_portal.html");
      if (teacherLink) teacherLink.setAttribute("href", (state.urlsData?.teacherHref) || "teacher_portal.html");
    }

    // ============ Tabs ============
    tabBtns.forEach(btn => btn.addEventListener("click", () => {
      tabBtns.forEach(b => b.classList.toggle("active", b === btn));
      [urlsPanel, imagesPanel, galleryPanel].forEach(p => p.classList.remove("active"));
      document.getElementById(btn.dataset.tab).classList.add("active");
    }));

    // ============ Image Manager ============
    function buildImageManager() {
      imageList.innerHTML = "";
      $all("img[data-editable-image]").forEach((img) => {
        const key = img.getAttribute("data-editable-image");
        const card = document.createElement("div");
        card.className = "image-card";

        const thumb = document.createElement("img");
        thumb.className = "thumb";
        thumb.src = img.src;
        thumb.alt = key;

        const rowTop = document.createElement("div");
        rowTop.className = "row";
        const label = document.createElement("small");
        label.textContent = key;

        const btns = document.createElement("div");
        btns.style.display = "flex";
        btns.style.gap = ".4rem";

        const replaceBtn = document.createElement("button");
        replaceBtn.className = "btn btn-outline btn-xs";
        replaceBtn.textContent = "Replace";
        replaceBtn.addEventListener("click", () => {
          if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
          const input = document.createElement("input");
          input.type = "file";
          input.accept = "image/*";
          input.addEventListener("change", async (e) => {
            const file = e.target.files?.[0];
            if (!file) return;
            const dataUrl = await fileToDataURL(file);
            img.src = dataUrl;
            thumb.src = dataUrl;
            toast("Image updated.", "success");
          });
          input.click();
        });

        const toggleBtn = document.createElement("button");
        toggleBtn.className = "btn btn-danger btn-xs";
        const updateLabel = () => toggleBtn.textContent = img.hidden ? "Show" : "Hide";
        updateLabel();
        toggleBtn.addEventListener("click", () => {
          if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
          img.hidden = !img.hidden;
          if (img.hidden) state.imagesHidden[key] = true; else delete state.imagesHidden[key];
          updateLabel();
          toast(img.hidden ? "Image hidden." : "Image shown.", "info");
        });

        btns.append(replaceBtn, toggleBtn);
        rowTop.append(label, btns);
        card.append(thumb, rowTop);
        imageList.append(card);
      });
    }

    // ============ Gallery Manager ============
    function buildGalleryManager(){
      categoryList.innerHTML = "";

      (state.galleryData?.categories || []).forEach((cat, idx) => {
        const card = document.createElement("div");
        card.className = "category-card";
        card.dataset.catId = cat.id;

        const head = document.createElement("div");
        head.className = "cat-head";

        const nameInput = document.createElement("input");
        nameInput.className = "cat-name-input";
        nameInput.value = cat.name;
        nameInput.placeholder = "Category name";
        nameInput.addEventListener("change", () => {
          cat.name = nameInput.value.trim() || cat.name;
          renderGallery(state.galleryData);
          toast("Category renamed.", "success");
        });

        const actions = document.createElement("div");
        actions.className = "cat-actions";

        const upBtn = smallBtn("↑ Move up", () => {
          if (idx === 0) return;
          const arr = state.galleryData.categories;
          [arr[idx-1], arr[idx]] = [arr[idx], arr[idx-1]];
          buildGalleryManager(); renderGallery(state.galleryData);
        });
        const downBtn = smallBtn("↓ Move down", () => {
          const arr = state.galleryData.categories;
          if (idx >= arr.length-1) return;
          [arr[idx+1], arr[idx]] = [arr[idx], arr[idx+1]];
          buildGalleryManager(); renderGallery(state.galleryData);
        });

        const removeBtn = smallBtn("Remove", () => {
          if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
          if (!confirm(`Remove category "${cat.name}"?`)) return;
          state.galleryData.categories = state.galleryData.categories.filter(c => c.id !== cat.id);
          buildGalleryManager(); renderGallery(state.galleryData);
          toast("Category removed.", "success");
        });

        const toggleBtn = smallBtn("Collapse", () => {
          gridWrap.hidden = !gridWrap.hidden;
          toggleBtn.textContent = gridWrap.hidden ? "Expand" : "Collapse";
        });

        const addPhotosBtn = smallBtn("+ Add photos", async () => {
          if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
          const input = document.createElement("input");
          input.type = "file"; input.accept = "image/*"; input.multiple = true;
          input.addEventListener("change", async (e) => {
            const files = Array.from(e.target.files || []);
            if (!files.length) return;
            for (const f of files) {
              const dataUrl = await fileToDataURL(f);
              cat.items.push({ id: uid("g"), src: dataUrl });
            }
            buildGalleryManager(); renderGallery(state.galleryData);
            toast("Photos added.", "success");
          });
          input.click();
        });

        const addByUrlBtn = smallBtn("Add by URL", () => {
          if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
          const url = prompt("Paste image URL:");
          if (!url) return;
          cat.items.push({ id: uid("g"), src: url.trim() });
          buildGalleryManager(); renderGallery(state.galleryData);
          toast("Photo added.", "success");
        });

        actions.append(upBtn, downBtn, addPhotosBtn, addByUrlBtn, toggleBtn, removeBtn);
        head.append(nameInput, actions);

        const gridWrap = document.createElement("div");
        const grid = document.createElement("div");
        grid.className = "photo-grid";
        (cat.items || []).forEach((item, itemIdx) => {
          const pCard = document.createElement("div");
          pCard.className = "photo-card";
          pCard.dataset.itemId = item.id;

          const thumb = document.createElement("img");
          thumb.src = item.src;
          thumb.alt = cat.name + " photo";

          const pActions = document.createElement("div");
          pActions.className = "photo-actions";

          const replace = xsBtn("Replace", async () => {
            if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
            const input = document.createElement("input");
            input.type = "file"; input.accept = "image/*";
            input.addEventListener("change", async (e) => {
              const file = e.target.files?.[0];
              if (!file) return;
              const dataUrl = await fileToDataURL(file);
              item.src = dataUrl; thumb.src = dataUrl;
              renderGallery(state.galleryData);
              toast("Photo replaced.", "success");
            });
            input.click();
          });

          const moveLeft = xsBtn("←", () => {
            if (itemIdx === 0) return;
            const arr = cat.items;
            [arr[itemIdx-1], arr[itemIdx]] = [arr[itemIdx], arr[itemIdx-1]];
            buildGalleryManager(); renderGallery(state.galleryData);
          });
          const moveRight = xsBtn("→", () => {
            const arr = cat.items;
            if (itemIdx >= arr.length-1) return;
            [arr[itemIdx+1], arr[itemIdx]] = [arr[itemIdx], arr[itemIdx+1]];
            buildGalleryManager(); renderGallery(state.galleryData);
          });

          const remove = xsBtn("Remove", () => {
            if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
            cat.items = cat.items.filter(it => it.id !== item.id);
            buildGalleryManager(); renderGallery(state.galleryData);
            toast("Photo removed.", "success");
          });

          pActions.append(replace, moveLeft, moveRight, remove);
          pCard.append(thumb, pActions);
          grid.append(pCard);
        });

        gridWrap.append(grid);
        card.append(head, gridWrap);
        categoryList.append(card);
      });

      addCategoryBtn.onclick = () => {
        if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
        const name = prompt("New category name:");
        if (!name) return;
        const idBase = name.toLowerCase().trim().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'') || uid("cat");
        const id = state.galleryData.categories.some(c => c.id === idBase) ? uid(idBase) : idBase;
        state.galleryData.categories.push({ id, name: name.trim(), items: [] });
        buildGalleryManager(); renderGallery(state.galleryData);
        toast("Category added.", "success");
      };

      collapseAllBtn.onclick = () => { $all(".category-card > div:nth-child(2)", categoryList).forEach(el => el.hidden = true); };
      expandAllBtn.onclick = () => { $all(".category-card > div:nth-child(2)", categoryList).forEach(el => el.hidden = false); };
    }

    function smallBtn(text, onClick){
      const b = document.createElement("button");
      b.className = "btn btn-outline btn-xs";
      b.textContent = text;
      b.addEventListener("click", onClick);
      return b;
    }
    function xsBtn(text, onClick){
      const b = document.createElement("button");
      b.className = "btn btn-secondary btn-xs";
      b.textContent = text;
      b.addEventListener("click", onClick);
      return b;
    }

    // ============ Inline editing ============
    function setInlineEditing(on){
      state.inlineEditing = on;
      document.body.classList.toggle("inline-editing", on);
      inlineBar.classList.toggle("show", on);
      inlineBar.setAttribute("aria-hidden", on ? "false" : "true");
      $all("[data-editable]").forEach(el => el.setAttribute("contenteditable", on ? "true" : "false"));
      if (on) { editModal.classList.remove("show"); editModal.setAttribute("aria-hidden", "true"); }
    }

    document.addEventListener("click", (e) => {
      const btn = e.target.closest("[data-delete-work]");
      if (!btn) return;
      if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
      const id = btn.getAttribute("data-delete-work");
      if (!confirm("Delete this work card?")) return;
      if (state.workData?.cards) state.workData.cards = state.workData.cards.filter(c => c.id !== id);
      const el = workGrid.querySelector(`[data-work-id="${id}"]`);
      if (el) el.remove();
      toast("Work card deleted.", "success");
    });

    addWorkCardBtn.addEventListener("click", () => {
      if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
      const title = prompt("Work card title:");
      if (!title) return;
      const desc = prompt("Work card description:") || "";
      const icon = prompt("Font Awesome icon class (optional, e.g., 'fas fa-hands-helping')") || "fas fa-star";
      const id = uid("w");
      if (!state.workData) state.workData = { cards: [] };
      state.workData.cards.push({ id, icon });
      renderWork(state.workData);
      const titleEl = document.querySelector(`[data-editable="work-title-${id}"]`);
      const descEl  = document.querySelector(`[data-editable="work-text-${id}"]`);
      if (titleEl) titleEl.textContent = title;
      if (descEl)  descEl.textContent  = desc;
      toast("Work card added.", "success");
    });

    openPanelBtn.addEventListener("click", () => {
      buildImageManager(); buildGalleryManager(); buildUrlsManager();
      editModal.classList.add("show"); editModal.setAttribute("aria-hidden","false");
    });

    inlineSaveBtn.addEventListener("click", async () => {
      if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
      const payload = collectContent();
      await saveToDatabase(payload);
      state.snapshot = collectContent();
      toast("Changes saved.", "success");
    });

    inlineExitBtn.addEventListener("click", () => {
      if (state.snapshot) applyContent(state.snapshot);
      state.adminAuthedForEdit = false; setInlineEditing(false);
      toast("Inline editing closed.", "info");
    });

    inlineToggleBtn.addEventListener("click", () => {
      if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
      state.snapshot = collectContent();
      setInlineEditing(true);
      toast("Inline editing enabled.", "info");
    });

    // ============ Dropdown + Password protection ============
    menuBtn?.addEventListener("click", () => {
      const show = !menuDropdown.classList.contains("show");
      menuDropdown.classList.toggle("show", show);
      menuBtn.setAttribute("aria-expanded", String(show));
      menuDropdown.setAttribute("aria-hidden", String(!show));
    });
    document.addEventListener("click", (e) => {
      if (!menuDropdown.contains(e.target) && e.target !== menuBtn) {
        menuDropdown.classList.remove("show");
        menuBtn.setAttribute("aria-expanded", "false");
        menuDropdown.setAttribute("aria-hidden", "true");
      }
    });

    [adminLink, teacherLink].forEach(link => {
      if (!link) return;
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const role = link.getAttribute("data-role");
        const pass = link.getAttribute("data-requires-pass");
        const href = link.getAttribute("href") || "#";
        state.pending = { role, pass, href, action: "nav" };
        openPasswordModal();
      });
    });

    function revealEditItem(){
      editBtn.style.display = "block";
      sessionStorage.setItem("canSeeEdit", "true");
      state.canSeeEdit = true;
    }
    if (state.canSeeEdit) revealEditItem();

    editBtn.addEventListener("click", () => {
      state.pending = { action: "edit", pass: "9733" };
      openPasswordModal();
    });

    // Password modal logic
    function openPasswordModal() {
      pwdError.textContent = "";
      pwdInput.value = "";
      updateBoxes("");
      pwdModal.classList.add("show");
      pwdModal.setAttribute("aria-hidden", "false");
      setTimeout(() => pwdInput.focus(), 50);
    }
    function closePasswordModal() {
      pwdModal.classList.remove("show");
      pwdModal.setAttribute("aria-hidden", "true");
    }
    function updateBoxes(val){
      codeBoxes.forEach((box, i) => {
        box.classList.toggle("filled", i < val.length);
        box.innerHTML = i < val.length ? '<span class="code-dot"></span>' : "";
      });
    }
    function addDigit(d){
      if (!/^\d$/.test(d)) return;
      if (pwdInput.value.length >= 4) return;
      pwdInput.value += d; updateBoxes(pwdInput.value);
    }
    function backspace(){ pwdInput.value = pwdInput.value.slice(0, -1); updateBoxes(pwdInput.value); }
    function clearCode(){ pwdInput.value = ""; updateBoxes(""); }
    function wrongCodeFlash(){
      pwdCard.classList.remove("shake"); void pwdCard.offsetWidth; pwdCard.classList.add("shake");
    }
    keypad.addEventListener("click", (e) => {
      const btn = e.target.closest(".key"); if (!btn) return;
      const key = btn.getAttribute("data-key"); const action = btn.getAttribute("data-action");
      if (key) addDigit(key);
      if (action === "back") backspace();
      if (action === "clear") clearCode();
      if (action === "cancel") { closePasswordModal(); return; }
      if (action === "enter" || pwdInput.value.length === 4) confirmPassword();
    });
    document.addEventListener("keydown", (e) => {
      if (!pwdModal.classList.contains("show")) return;
      if (/^\d$/.test(e.key)) addDigit(e.key);
      if (e.key === "Backspace") backspace();
      if (e.key === "Escape") closePasswordModal();
      if (e.key === "Enter") confirmPassword();
    });
    function confirmPassword(){
      const given = (pwdInput.value || "").trim();
      const { pass, role, href, action } = state.pending || {};
      if (!given) return;
      if (action === "edit") {
        if (given === "9733") {
          state.adminAuthedForEdit = true;
          revealEditItem();
          closePasswordModal();
          openEditor();
          toast("Edit unlocked.", "success");
        } else {
          pwdError.textContent = "Admin password required (9733).";
          wrongCodeFlash(); clearCode();
        }
        return;
      }
      if (action === "nav") {
        if (given === pass) {
          revealEditItem();
          closePasswordModal();
          window.location.href = href;
        } else {
          pwdError.textContent = "Incorrect code. Try again.";
          wrongCodeFlash(); clearCode();
        }
        return;
      }
    }
    pwdConfirmFallback?.addEventListener("click", confirmPassword);
    pwdCancelFallback?.addEventListener("click", closePasswordModal);
    pwdClose.addEventListener("click", closePasswordModal);

    // Editor open/close/save
    function openEditor(){
      state.snapshot = collectContent();
      buildImageManager(); buildGalleryManager(); buildUrlsManager();
      tabBtns.forEach(b => b.classList.remove("active"));
      document.querySelector('.tab-btn[data-tab="urls-panel"]').classList.add("active");
      [urlsPanel, imagesPanel, galleryPanel].forEach(p => p.classList.remove("active"));
      urlsPanel.classList.add("active");
      editModal.classList.add("show"); editModal.setAttribute("aria-hidden", "false");
    }
    function closeEditor(){
      if (state.snapshot) applyContent(state.snapshot);
      state.adminAuthedForEdit = false; setInlineEditing(false);
      editModal.classList.remove("show"); editModal.setAttribute("aria-hidden", "true");
      toast("Editor closed.", "info");
    }
    editClose.addEventListener("click", closeEditor);
    closeEditorBtn.addEventListener("click", closeEditor);

    saveBtn.addEventListener("click", async () => {
      if (!state.adminAuthedForEdit) return void toast("Admin password (9733) required.", "error");
      const payload = collectContent();
      await saveToDatabase(payload);
      state.snapshot = collectContent();
      toast("Changes saved.", "success");
    });

    // URLs Manager
    function buildUrlsManager(){
      adminUrlInput.value = (state.urlsData && state.urlsData.adminHref) || "admin_portal.html";
      teacherUrlInput.value = (state.urlsData && state.urlsData.teacherHref) || "teacher_portal.html";
      const update = () => {
        state.urlsData = { adminHref: (adminUrlInput.value||"").trim(), teacherHref: (teacherUrlInput.value||"").trim() };
        applyUrlsToMenu();
      };
      adminUrlInput.oninput = update; teacherUrlInput.oninput = update;
      adminUrlClear.onclick = () => { adminUrlInput.value = ""; update(); toast("Admin URL cleared.", "warning"); };
      teacherUrlClear.onclick = () => { teacherUrlInput.value = ""; update(); toast("Teacher URL cleared.", "warning"); };
    }

    // Accessibility & shortcuts
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") { menuDropdown.classList.remove("show"); }
      if (state.inlineEditing && (e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "s") {
        e.preventDefault(); inlineSaveBtn.click();
      }
    });

    // Init
    (async function init(){
      const loaded = await loadFromDatabase();
      const payload = loaded || defaultPayload;
      if (!payload.work) payload.work = defaultPayload.work;
      if (!payload.urls) payload.urls = defaultPayload.urls;
      if (!payload.imagesHidden) payload.imagesHidden = {};
      applyContent(payload);
      if (!loaded) await saveToDatabase(collectContent());
    })();

  })();
  </script>
</body>
</html>